name: ðŸ§ª Test Email Sender

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼

jobs:
  test-sender:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: ðŸ“¦ Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: ðŸ§ª Create test data
      run: |
        mkdir -p test_data
        echo '${{ toJson(github.event.inputs) }}' > test_data/config.json
        
    - name: âœ… Test daily_sender.py (Dry Run)
      env:
        GMAIL_EMAIL: ${{ secrets.GMAIL_EMAIL }}
        APP_PASSWORD: ${{ secrets.APP_PASSWORD }}
        TO_EMAIL: ${{ secrets.TO_EMAIL }}
      run: |
        python daily_sender.py --dry-run --config test_data/config.json
        
    - name: ðŸ“Š Upload test logs
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-logs
        path: |
          test_email_log.txt
          *.log
